version: 2.1

orbs:
  matlab: mathworks/matlab@1

workflows:
  build-workflow:
    jobs:
      - build

jobs:
  build:
    machine: true
    resource_class: sameagen-mw/windows
    steps:
      - checkout
    #  - run: # Linux agent
    #      name: Add MATLAB to path
    #      command: |
    #        echo 'export PATH=/path/to/MATLAB/bin:"$PATH"' >> "$BASH_ENV"
    #        source "$BASH_ENV"
    # - run: # mac agent
    #     name: Add MATLAB to path
    #     command: |
    #       echo 'export PATH=/path/to/MATLAB.app/bin:"$PATH"' >> "$BASH_ENV"
    #       source "$BASH_ENV"
      - run: # windows agent
          name: Add MATLAB to path
          shell: powershell.exe -ExecutionPolicy Bypass
          command: |
            $matlab_path = "C:\Program Files\MATLAB\R2023b\bin"
            if ((Get-Command "matlab.exe" -ErrorAction SilentlyContinue).Path -neq $matlab_path)
            {
                Add-Content -Path $PROFILE -Value "$env:Path = '$matlab_path;' + $env:Path"
            }
            . $PROFILE
      - matlab/run-command:
          command: ver